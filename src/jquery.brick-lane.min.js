/*!
 * Brick Lane v0.0.1
 * Hipstery Cascading Grid Layout Library
 * MIT License
 * by Nicholas Valbusa
 */

(function(e,t){var n="BrickLanePlugin";t.fn.brickLane=function(r){if(typeof r==="string"){var i=slice.call(arguments,1);for(var s=0,o=this.length;s<o;s++){var u=this[s];var a=t.data(u,n);if(!a){logError("Cannot call "+n+" prior to BrickLane initialization; "+"options: '"+r+"'");continue}if(!t.isFunction(a[r])||r.charAt(0)==="_"){logError("Method '"+r+"' doesn't exist for "+n);continue}var f=a[r].apply(a,i);if(f!==undefined){return f}}return this}var l=function(e){return!jQuery.isArray(e)&&e-parseFloat(e)+1>=0};var c=t.extend({columnWidth:"auto",itemSelector:undefined,isResizeBound:true},r);var h=function(n,r){var i=t(n),s=undefined,o=undefined,u=0,a=1,f=[],l=undefined,c=false,h=undefined;_init=function(){if(c){_cleanup()}i.css("overflow","hidden");if(i.css("position")=="static"){i.css("position","relative")}s=r.itemSelector?i.find(r.itemSelector):i.children();if(typeof r.columnWidth==="function"){o=r.columnWidth}else{o=function(){if(r.columnWidth=="auto"){if(s.size()>0){u=s.first().outerWidth()}else{u=300}}else{u=r.columnWidth}console.log("columnWidthComputed",u);return u}}_onViewportResize(0);if(r.isResizeBound){_bindResize()}c=true},_cleanup=function(){f=[]},_destroy=function(){_unbindResize();i.removeAttr("style");s.each(function(){t(this).removeAttr("style")})},_onViewportResize=function(t){if(h){e.clearTimeout(h);delete h}e.setTimeout(function(){var e=i.width();console.log(e,l);if(e!==l){l=e;_setViewportSize();_layoutElements()}},t?t:50)},_bindResize=function(){t(e).on("resize",_onViewportResize)},_unbindResize=function(){t(e).off("resize",_onViewportResize)},_addElement=function(e){i.append(e);_layoutElement(e)},_layoutElements=function(){s.each(function(){_layoutElement(t(this))});_adjustViewportHeight()};_layoutElement=function(e){var t=e.outerWidth(),n=e.outerHeight(true);console.log("---");console.log("element size",t,n);var r=1;var i=Math.min.apply(Math,f);console.log("min y",i,"from",f);var s=f.indexOf(i);console.log("shortest column index:",s);var o={x:u*s,y:i};console.log("position to use:",o);f[s]+=n;console.log("new columns heights",f);data={left:o.x,top:o.y};if(e.css("position")!=="absolute"){data.position="absolute"}e.css(data)},_adjustViewportHeight=function(){var e=Math.max.apply(Math,f);i.css("height",e)};_setViewportSize=function(){var e=o();a=Math.floor(l/e);console.log("columns count",a);f=[];for(var t=0;t<a;t++){f.push(0)}};return{initialize:function(){_init()},setOptions:function(e){r=e},appended:function(e){_appendedElement(e)},append:function(e){_addElement(e)},destroy:function(){_destroy()}}};return this.each(function(){var e=t.data(this,n);if(e){console.debug("calling instance");e.setOptions(c)}else{e=new h(this,c);t.data(this,n,e)}e.initialize()})}})(window,jQuery)